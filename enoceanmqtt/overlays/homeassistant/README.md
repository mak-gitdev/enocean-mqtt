# Home Assistant Overlay for enoceanmqtt

This is a [Home Assistant](https://www.home-assistant.io/) overlay for [enoceanmqtt](https://github.com/embyt/enocean-mqtt).  
It allows to easily have access EnOcean devices in Home Assistant through MQTT.  
It is based on MQTT discovery from the Home Assistant MQTT integration.

## Installation
For the moment, to install it, perform the following actions:

### 1- Install enoceanmqtt
 - `pip install enocean-mqtt`

### 2- Install TinyDB
 - `pip install tinydb`

### 3- Install the Home Assistant overlay
 - Copy the *__`enoceanmqtt/overlays`__* folder to enoceanmqtt
 - Replace *__`enoceanmqtt/enoceanmqtt.py`__*

## Configuration
`enoceanmqtt.conf` is used as usual, except that:
- *`overlay = HA`* shall be added in the config section to indicate that the HA overlay is to be used.
- *`mqtt_discovery_topic = <topic>`* shall also be added in the config section, where *`<topic>`* is the MQTT topic used for discovery and configured in the Home Assistant MQTT integration.

## Usage

### 1- Pairing your device
If pairing is needed, please follow the instruction of your device regarding pairing.  
enoceanmqtt supports pairing through the Python EnOcean library.  
Once your device is in pairing mode, the pairing response will be submitted automatically.  

Note: For the moment, pairing is always on. Thus it could interfere during the pairing of your device to another EnOcean device. This has been identified and will be fixed in a future commit to enable controllable pairing.

### 2- Normal usage
Enoceanmqtt works as usual except that the first EnOcean packet generated by your supported EnOcean device will lead to the discovery of your device in Home Assistant, under the MQTT integration's devices and entities.  
Once your device is discovered, it is also stored in a database of known devices and any other packets will be handled as usual by enoceanmqtt.

### 3- Delete your device from Home Assistant
If you want to delete your device from Home Assistant:
 - Browse to the devices of MQTT integration
 - Click on your device
 - Click on the delete button in the configuration section
 
You can then rediscover your device again as aforementioned.

## Supported Devices
Note: If your device is not supported yet, please feel free to ask me for adding your device or feel free to add it to *__`mapping.yaml`__* and make a pull request.
 - [x] `D2-01-0B` 
 - [x] `D2-01-0C`
 - [ ] `D2-01-0F` (not tested)
 - [x] `D2-01-12`
 - [ ] `D2-05-00` (not tested)
 - [x] `F6-02-01`
 - [ ] `F6-02-02` (not tested)
 - [x] `D5-00-01`
 - [ ] `A5-12-00` (not tested)
 - [ ] `A5-12-01` (not tested)

For devices not yet supported, only the RSSI sensor is created in Home Assistant.
